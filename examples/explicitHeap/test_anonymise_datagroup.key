

\functions {
   \nonRigid[Location] Object o1;
   \nonRigid[Location] Object o2;
   \unique Field f;
   
   LocSet dataGroup(Heap);
   
   Heap heapAtPre;
   Heap anonHeap;   
   LocSet modAtPre;
}

\problem {
    //We anonymise the modifies clause "{dataGroup}", 
    //where "o2.*" is disjoint from the data group
    
    select(heap, o2, f) = 33
    & disjoint(allFields(o2), dataGroup(heap))
    & heap = heapAtPre
    & modAtPre = dataGroup(heap)
    
    ->
    
    {heap := anonHeap}
    (
       //all heap locations must either be unchanged or be in the modifies clause
       (\forall Object o; \forall Field g; (
             select(heap, o, g) = select(heapAtPre, o, g)
             | elementOf(o, g, modAtPre)
       ))
       ->
       select(heap, o2, f) = 33
    )
}  