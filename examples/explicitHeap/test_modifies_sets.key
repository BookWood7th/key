\javaSource "src";

\programVariables {
    MyClass self;
    MyClass b;
}

\functions {
   Heap heapAtPre;
   LocSet modAtPre;
   
   //these would be automatically created on demand later, but we already need them here
   \unique Field MyClass::next;
   \unique Field MyClass::attr;
}


\problem {
    //Modifies clause is {self.next, b.next.next, b.next.next.next, self.attr}
    modAtPre = union(singleton(self, MyClass::next),
                     union(singleton(b.next, MyClass::next),
                           union(singleton(b.next.next, MyClass::next),
                                 singleton(self, MyClass::attr))))
      
    //atPre definitions                            
    & heap = heapAtPre
    
    ->
    
    \[{
          self.next = b.next.next;
          b.next.next = b;
          self.attr++;
    }\]
    
    
    //all heap locations must either be unchanged or be in the modifies clause
    (\forall Object o; \forall Field g; (
             select(heap, o, g) = select(heapAtPre, o, g)
             | elementOf(o, g, modAtPre)
    ))
}  
